"use client";
import { Button } from "./button";
import { LogoutLink } from "@kinde-oss/kinde-auth-nextjs/components";
import AuthDialog from "./auth-dialog";
import { useState, useEffect, useRef } from "react";
import { Dialog, DialogTrigger } from "@/components/ui/dialog";
import { useToast } from "@/components/ui/use-toast";

interface AuthButtonsGroupProps {
  btnText?: string;
  isUserAuthenticated: boolean;
}

export default function AuthButtonsGroup({
  btnText,
  isUserAuthenticated,
}: AuthButtonsGroupProps) {
  const [isOpen, setIsOpen] = useState(false);
  let timerID = useRef<number | null>(null);

  function showDialog() {
    setIsOpen(true);
  }

  const { toast } = useToast();

  // If isUserAuthenticated is false, set a timeout for 5 seconds and display the AuthDialog
  useEffect(() => {
    if (isUserAuthenticated === false) {
      timerID.current = window.setTimeout(() => {
        setIsOpen(true);
      }, 5000);
    }

    return () => {
      if (timerID.current) {
        clearTimeout(timerID.current);
      }
    };
  }, [isUserAuthenticated, toast]);

  return (
    <div className={``}>
      <Dialog>
        {isUserAuthenticated ? (
          <Button
            size={"sm"}
            className="mx-2 auth_btn bg-red-500 w-full"
            variant={"default"}
          >
            <LogoutLink postLogoutRedirectURL="/"> Logout </LogoutLink>
            <AuthIcon />
          </Button>
        ) : (
          <DialogTrigger className="w-full">
            <Button
              size={"sm"}
              className="mx-2 auth_btn bg-green-400 w-full"
              variant={"default"}
              onClick={showDialog}
            >
              {btnText || "Auth"}
              <GhostIcon />
            </Button>
          </DialogTrigger>
        )}
      </Dialog>
      <AuthDialog isOpen={isOpen} onOpenChange={setIsOpen} />
    </div>
  );
}

function AuthIcon(props: any) {
  return (
    <svg
      className="ms-2"
      width="22"
      height="18"
      viewBox="0 0 22 18"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M7.21891 8.25186C7.21891 7.50401 7.44067 6.77295 7.85616 6.15114C8.27164 5.52933 8.86218 5.04468 9.5531 4.75849C10.244 4.4723 11.0043 4.39742 11.7378 4.54332C12.4713 4.68922 13.145 5.04934 13.6738 5.57815C14.2026 6.10696 14.5627 6.7807 14.7086 7.51418C14.8545 8.24766 14.7797 9.00794 14.4935 9.69886C14.2073 10.3898 13.7226 10.9803 13.1008 11.3958C12.479 11.8113 11.748 12.0331 11.0001 12.0331C9.99727 12.0331 9.03551 11.6347 8.3264 10.9256C7.61728 10.2165 7.21891 9.25469 7.21891 8.25186ZM18.0606 13.1657C17.9075 13.0768 17.7265 13.0487 17.5536 13.0871C17.3807 13.1255 17.2285 13.2274 17.1274 13.3728C16.9792 13.5769 16.8209 13.7733 16.653 13.9615C16.1528 13.2355 15.5173 12.6128 14.7813 12.1276C14.7185 12.086 14.6438 12.0661 14.5687 12.0711C14.4935 12.0761 14.4221 12.1056 14.3654 12.1551C13.4314 12.9632 12.2377 13.408 11.0027 13.408C9.76765 13.408 8.57392 12.9632 7.64 12.1551C7.58285 12.1043 7.51043 12.0741 7.43417 12.0691C7.35791 12.0641 7.28217 12.0847 7.21891 12.1276C6.48275 12.6119 5.84694 13.2337 5.34636 13.9589C4.27272 12.7533 3.61479 11.2347 3.46951 9.62684H4.79293C4.90421 9.62859 5.01432 9.60396 5.11425 9.55497C5.21418 9.50598 5.30108 9.43401 5.36784 9.34497C5.46471 9.21254 5.51103 9.04983 5.49842 8.88625C5.48581 8.72266 5.41511 8.56897 5.2991 8.45295L3.23663 6.39048C3.17278 6.32656 3.09695 6.27585 3.01349 6.24125C2.93003 6.20666 2.84057 6.18885 2.75023 6.18885C2.65988 6.18885 2.57042 6.20666 2.48696 6.24125C2.4035 6.27585 2.32768 6.32656 2.26383 6.39048L0.201358 8.45295C0.0853408 8.56897 0.0146418 8.72266 0.00203375 8.88625C-0.0105743 9.04983 0.0357399 9.21254 0.13261 9.34497C0.199371 9.43401 0.286275 9.50598 0.386203 9.55497C0.486132 9.60396 0.596244 9.62859 0.707523 9.62684H2.08852C2.22913 11.4546 2.92839 13.1949 4.0915 14.6119C5.25461 16.0288 6.8253 17.0538 8.59064 17.5479C10.356 18.042 12.2306 17.9813 13.9602 17.3741C15.6899 16.7668 17.191 15.6423 18.26 14.1531C18.3151 14.0763 18.3539 13.989 18.3738 13.8966C18.3936 13.8041 18.3942 13.7086 18.3755 13.6159C18.3568 13.5233 18.3192 13.4355 18.265 13.358C18.2108 13.2805 18.1412 13.2151 18.0606 13.1657ZM21.9475 8.67638C21.8955 8.55075 21.8074 8.44336 21.6944 8.3678C21.5813 8.29223 21.4484 8.25189 21.3124 8.25186H19.9117C19.7711 6.42408 19.0718 4.68375 17.9087 3.26681C16.7456 1.84987 15.1749 0.824865 13.4096 0.330763C11.6442 -0.16334 9.76966 -0.102639 8.03998 0.504635C6.31031 1.11191 4.80922 2.23638 3.74021 3.7256C3.63377 3.87374 3.59055 4.0581 3.62004 4.23812C3.64953 4.41814 3.74933 4.57907 3.89748 4.68551C4.04562 4.79194 4.22998 4.83517 4.41 4.80568C4.59002 4.77618 4.75095 4.67639 4.85738 4.52824C5.75677 3.27602 7.01741 2.3286 8.47037 1.81295C9.92332 1.2973 11.4992 1.23806 12.9867 1.64317C14.4743 2.04827 15.8025 2.89837 16.7934 4.07954C17.7843 5.2607 18.3904 6.71651 18.5307 8.25186H17.1875C17.0515 8.25175 16.9184 8.29201 16.8053 8.36755C16.6921 8.44308 16.6039 8.55049 16.5518 8.67618C16.4998 8.80187 16.4861 8.94019 16.5127 9.07362C16.5393 9.20705 16.6049 9.3296 16.7011 9.42575L18.7636 11.4882C18.8274 11.5521 18.9033 11.6028 18.9867 11.6374C19.0702 11.672 19.1596 11.6898 19.25 11.6898C19.3403 11.6898 19.4298 11.672 19.5132 11.6374C19.5967 11.6028 19.6725 11.5521 19.7364 11.4882L21.7988 9.42575C21.895 9.32955 21.9604 9.207 21.9869 9.07362C22.0133 8.94023 21.9996 8.80199 21.9475 8.67638Z"
        fill="black"
      />
    </svg>
  );
}

function GhostIcon(props: any) {
  return (
    <svg
      width="22"
      className="ms-2"
      height="23"
      viewBox="0 0 22 23"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M11 0C8.08364 0.00333593 5.28769 1.16333 3.22551 3.22551C1.16333 5.28769 0.00333595 8.08364 2.06235e-08 11V22C-3.67956e-05 22.1736 0.0492193 22.3436 0.142038 22.4903C0.234856 22.637 0.36742 22.7543 0.524308 22.8286C0.681196 22.903 0.855958 22.9312 1.02826 22.91C1.20056 22.8889 1.36332 22.8193 1.4976 22.7093L4.2774 20.4348L7.05833 22.7093C7.22209 22.8432 7.42714 22.9164 7.6387 22.9164C7.85026 22.9164 8.05531 22.8432 8.21906 22.7093L11 20.4348L13.7809 22.7093C13.9447 22.8432 14.1497 22.9164 14.3613 22.9164C14.5729 22.9164 14.7779 22.8432 14.9417 22.7093L17.7226 20.4348L20.5024 22.7093C20.6367 22.8193 20.7994 22.8889 20.9717 22.91C21.144 22.9312 21.3188 22.903 21.4757 22.8286C21.6326 22.7543 21.7651 22.637 21.858 22.4903C21.9508 22.3436 22 22.1736 22 22V11C21.9967 8.08364 20.8367 5.28769 18.7745 3.22551C16.7123 1.16333 13.9164 0.00333593 11 0ZM7.79167 11.9167C7.51972 11.9167 7.25388 11.836 7.02776 11.6849C6.80164 11.5339 6.6254 11.3191 6.52133 11.0679C6.41726 10.8166 6.39003 10.5401 6.44309 10.2734C6.49614 10.0067 6.6271 9.76169 6.81939 9.56939C7.01169 9.3771 7.25669 9.24614 7.52342 9.19309C7.79014 9.14003 8.06661 9.16726 8.31786 9.27133C8.5691 9.3754 8.78385 9.55164 8.93494 9.77776C9.08602 10.0039 9.16667 10.2697 9.16667 10.5417C9.16667 10.9063 9.0218 11.2561 8.76394 11.5139C8.50608 11.7718 8.15634 11.9167 7.79167 11.9167ZM14.2083 11.9167C13.9364 11.9167 13.6705 11.836 13.4444 11.6849C13.2183 11.5339 13.0421 11.3191 12.938 11.0679C12.8339 10.8166 12.8067 10.5401 12.8598 10.2734C12.9128 10.0067 13.0438 9.76169 13.2361 9.56939C13.4284 9.3771 13.6734 9.24614 13.9401 9.19309C14.2068 9.14003 14.4833 9.16726 14.7345 9.27133C14.9858 9.3754 15.2005 9.55164 15.3516 9.77776C15.5027 10.0039 15.5833 10.2697 15.5833 10.5417C15.5833 10.9063 15.4385 11.2561 15.1806 11.5139C14.9227 11.7718 14.573 11.9167 14.2083 11.9167Z"
        fill="black"
      />
    </svg>
  );
}
